<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="report name" language="groovy" pageWidth="595" pageHeight="842" columnWidth="535" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20" uuid="03b2d599-22c6-4d9c-bff2-9c3b1084a7ca">
	<property name="ireport.zoom" value="1.0"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<subDataset name="conexion2" uuid="7dfdd014-ba52-4af8-99a4-e36770301c10">
		<queryString>
			<![CDATA[select e.nombre, count(*) as cantidad, (avg(((select count(*) from detalle_prestamo as dpe inner join prestamo as pre on pre.codigopre = dpe.codigopre inner join libro as lib on  lib.isbn = dpe.isbn inner join editorial as edi on edi.codigoedi = lib.codigoedi where edi.codigoedi = e.codigoedi)*100)/(select count(*) from detalle_prestamo as dpre inner join prestamo as pres on pres.codigopre = dpre.codigopre inner join libro as li on  li.isbn = dpre.isbn inner join editorial as ed on ed.codigoedi = li.codigoedi))::float) as porcentaje from detalle_prestamo as dp inner join prestamo as p on p.codigopre = dp.codigopre inner join libro as l on  l.isbn = dp.isbn inner join editorial as e on e.codigoedi = l.codigoedi group by e.nombre;]]>
		</queryString>
		<field name="nombre" class="java.lang.String"/>
		<field name="cantidad" class="java.lang.Long"/>
		<field name="porcentaje" class="java.lang.Double"/>
	</subDataset>
	<queryString>
		<![CDATA[select l.titulo,(select extract(year from p.fechapre)) as fecha, e.nombre, count(*) as cantidad from detalle_prestamo as dp inner join prestamo as p on p.codigopre = dp.codigopre inner join libro as l on  l.isbn = dp.isbn inner join editorial as e on e.codigoedi = l.codigoedi inner join prestamo pre on pre.codigopre = dp.codigopre where (select extract(year from pre.fechapre)) = (select extract(year from current_date)) group by e.nombre, l.titulo, fecha order by 3 desc;]]>
	</queryString>
	<field name="titulo" class="java.lang.String"/>
	<field name="fecha" class="java.lang.Double"/>
	<field name="nombre" class="java.lang.String"/>
	<field name="cantidad" class="java.lang.Long"/>
	<background>
		<band splitType="Stretch"/>
	</background>
	<title>
		<band height="79" splitType="Stretch">
			<staticText>
				<reportElement x="0" y="0" width="555" height="57" uuid="89108b97-50f1-42b0-aa81-2eb531df96c8"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Poppins" size="16" isBold="true"/>
				</textElement>
				<text><![CDATA[Reportes de porcentaje de libros prestados por editoriales en el año]]></text>
			</staticText>
			<textField pattern="yyyy/MM/dd">
				<reportElement x="267" y="33" width="39" height="38" uuid="65091f99-9a0f-45cd-b08d-338d329bf705"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Poppins" size="16" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[new java.util.Date()]]></textFieldExpression>
			</textField>
		</band>
	</title>
	<pageHeader>
		<band splitType="Stretch"/>
	</pageHeader>
	<columnHeader>
		<band height="50" splitType="Stretch">
			<rectangle radius="10">
				<reportElement x="0" y="0" width="555" height="50" backcolor="#536DFE" uuid="ada13cfc-5858-4a4f-bc9d-33b00cf2cca4"/>
			</rectangle>
			<staticText>
				<reportElement x="0" y="0" width="200" height="50" uuid="38695914-f49c-4da4-9336-e795ab2dff68"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Poppins"/>
				</textElement>
				<text><![CDATA[LIBRO]]></text>
			</staticText>
			<staticText>
				<reportElement x="200" y="0" width="200" height="50" uuid="13a215a0-b3bb-44ee-9444-976445016056"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Poppins"/>
				</textElement>
				<text><![CDATA[EDITORIAL]]></text>
			</staticText>
			<staticText>
				<reportElement x="472" y="0" width="83" height="50" uuid="3438dbcf-8b38-45e8-aeca-9877410c9a05"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Poppins"/>
				</textElement>
				<text><![CDATA[CANTIDAD]]></text>
			</staticText>
			<staticText>
				<reportElement x="400" y="0" width="72" height="50" uuid="68185f12-ed43-420d-b21e-014efd3e3490"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Poppins"/>
				</textElement>
				<text><![CDATA[AÑO]]></text>
			</staticText>
		</band>
	</columnHeader>
	<detail>
		<band height="49" splitType="Stretch">
			<line>
				<reportElement x="0" y="41" width="555" height="1" forecolor="#536DFE" backcolor="#536DFE" uuid="87a058c3-cd80-4222-8bf9-54425124d63c"/>
				<graphicElement>
					<pen lineStyle="Dashed"/>
				</graphicElement>
			</line>
			<textField>
				<reportElement x="0" y="10" width="200" height="20" uuid="567db290-5295-44ac-8418-f807500f4fb4"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Poppins"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{titulo}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="200" y="10" width="200" height="20" uuid="de5500fd-ce5d-4582-adea-7ac138637c4c"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Poppins"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{nombre}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="472" y="10" width="83" height="20" uuid="71a4d883-9457-4048-b5ce-f18d71ca9c52"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Poppins"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{cantidad}]]></textFieldExpression>
			</textField>
			<textField pattern="###0">
				<reportElement x="400" y="10" width="72" height="20" uuid="9636aa46-80e9-4fd7-a8e7-cddc8732eede"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Poppins"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{fecha}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<columnFooter>
		<band splitType="Stretch"/>
	</columnFooter>
	<pageFooter>
		<band height="34" splitType="Stretch">
			<textField>
				<reportElement x="455" y="14" width="100" height="20" uuid="006eb74f-1fcc-4006-b754-d5ab629813d5"/>
				<textElement>
					<font fontName="Poppins"/>
				</textElement>
				<textFieldExpression><![CDATA[$V{PAGE_NUMBER}]]></textFieldExpression>
			</textField>
			<textField pattern="EEEEE dd MMMMM yyyy">
				<reportElement x="37" y="14" width="100" height="20" uuid="65d28de5-f837-4762-b31c-b722a417dc2c"/>
				<textElement>
					<font fontName="Poppins"/>
				</textElement>
				<textFieldExpression><![CDATA[new java.util.Date()]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="0" y="14" width="37" height="20" uuid="bfd4d56f-e79b-414b-a999-4cabe31e9398"/>
				<textElement>
					<font fontName="Poppins"/>
				</textElement>
				<text><![CDATA[Fecha:]]></text>
			</staticText>
		</band>
	</pageFooter>
	<summary>
		<band height="272" splitType="Stretch">
			<pie3DChart>
				<chart>
					<reportElement x="28" y="34" width="500" height="225" uuid="c380accb-3992-4777-ad6f-7175259a3c04"/>
					<chartTitle/>
					<chartSubtitle/>
					<chartLegend/>
				</chart>
				<pieDataset>
					<dataset>
						<datasetRun subDataset="conexion2" uuid="bfc19098-b09f-411c-b07f-6b1cb3f9e92a"/>
					</dataset>
					<keyExpression><![CDATA[$F{nombre}]]></keyExpression>
					<valueExpression><![CDATA[$F{porcentaje}]]></valueExpression>
					<labelExpression><![CDATA[$F{porcentaje}.toString() + "%"]]></labelExpression>
				</pieDataset>
				<pie3DPlot>
					<plot/>
					<itemLabel/>
				</pie3DPlot>
			</pie3DChart>
		</band>
	</summary>
</jasperReport>
